# 端口开放

```
mysql
console
server
agent1
agent2
agent3
```



# 统计信息

## console

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console" &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "======================logcenter固定信息==========================="  &&
tar_form="*Console.tar" &&
db_lib_dir="libs" &&
config_file="conf/application.properties" &&
start_sh="startBFTConsole.sh" &&
stop_sh="stopBFTConsole.sh" &&
log_file="logs/eos-trace.log"



=================================
启动程序
	// cd $app_dir
	nohup ./startBFTConsole.sh &
关闭程序
	// cd $app_dir
    bash stopBFTConsole.sh
```

## server

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console" &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "======================logcenter固定信息==========================="  &&
tar_form="*Console.tar" &&
db_lib_dir="libs" &&
config_file="conf/application.properties" &&
start_sh="startBFTConsole.sh" &&
stop_sh="stopBFTConsole.sh" &&
log_file="logs/eos-trace.log"



=================================
启动程序
	// cd $app_dir
	nohup ./startBFTConsole.sh &
关闭程序
	// cd $app_dir
    bash stopBFTConsole.sh
```



# 安装

## 顺序

```
BFT数据库初始化、
BFT Console、
BFT Server、
BFT LogCenter、
BFT Agent。
```



# 升级 -- 解压复制旧文件

## 前提

### 安装包目录

```java
注意：
    1. 加入你安装在 /opt/bft/bft7.5.0AG1043 下面
    2. 将安装包都复制到该文件夹中




    Primeton_BFT_7.5.0_Agent.tar
    Primeton_BFT_7.5.0_Agent.tar.sha256
 
    Primeton_BFT_7.5.0_Client.tar
    Primeton_BFT_7.5.0_Client.tar.sha256
 
    Primeton_BFT_7.5.0_Console.tar
    Primeton_BFT_7.5.0_Console.tar.sha256
 
    Primeton_BFT_7.5.0_LogCenter.tar
    Primeton_BFT_7.5.0_LogCenter.tar.sha256
 
    Primeton_BFT_7.5.0_Server.tar
    Primeton_BFT_7.5.0_Server.tar.sha256
 
    primeton-installer-1.2.0.tar
    primeton-installer-1.2.0.tar.sha256
    
    数据库驱动.jar
    
    // ==========================================
   	bft70_update.zip
    bft70_update.zip.sha256
    dbscripts.zip
    dbscripts.zip.sha256
    
    // ==========================================
    Primeton_BFT_7.5.0_Agent_Linux_VisualInstall.tar
    Primeton_BFT_7.5.0_Agent_Linux_VisualInstall.tar.sha256
 
    Primeton_BFT_7.5.0_Console_Linux_VisualInstall.tar
    Primeton_BFT_7.5.0_Console_Linux_VisualInstall.tar.sha256
 
    Primeton_BFT_7.5.0_LogCenter_Linux_VisualInstall.tar
    Primeton_BFT_7.5.0_LogCenter_Linux_VisualInstall.tar.sha256
 
    Primeton_BFT_7.5.0_Server_Linux_VisualInstall.tar
    Primeton_BFT_7.5.0_Server_Linux_VisualInstall.tar.sha256    
 
```

### 安装顺序

```

```

### 安装目录

```
console
	/opt/bft/bft7.5.0AG1043/
    	Primeton....console
servr
logcenter
agent
```

## 原理

```bash
console, server, logcenter 的安装步骤都是一样的

#!/bin/bash

1. 创建安装的文件夹，然后进行解压
2. 移动数据库 jar 包
3. 复制一份配置文件到当前 app/tmp 文件夹下面进行备份， 然后将旧的复制到原本的目录下面

# 创建安装的文件夹

tar_form="*Console.tar" &&
app_jar=$(find . -name $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
tar -vxf $app_jar -C $app_dir &&
clear;\
ll;\

# ====================================================
# ====================================================
# 数据库jar包
tar_form="*Console.tar" &&
app_jar=$(find . -name $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&

db_driver='mysql-connector-java-5.1.32.jar" &&
db_lib_dir="libs" &&

echo $(ls $app_dir/$db_lib_dir | grep sql) &&
cp $db_driver $app_dir/$db_lib_dir &&
echo $(ls $app_dir/$db_lib_dir | grep sql) &&

# ====================================================
# ====================================================

# 复制旧的配置文件 ===> 到当前
# 逻辑： old_dir ==> tmp ==> 新的环境， application.properties 复制一份然后删除
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console" &&
tar_form="*Console.tar" &&
app_jar=$(find . -name $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
config_file="conf/application.properties" &&
config_dir=$(dirname $config_file) &&
cp  $app_dir/$config_file $app_dir/${config_file}.bak &&
rm $app_dir/$config_file &&
mkdir -p "tmp/$config_dir" &&
cp ${old_app_dir}/$config_file tmp/${config_dir} &&
cp tmp/${config_file} $app_dir/$config_dir  &&
ll $app_dir/$config_dir; \


# ====================================================
# ====================================================
# -- 停止原本的服务,启动新的服务
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console" &&
tar_form="*Console.tar" &&
app_jar=$(find . -name $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
bash ${old_app_dir}/stopBFTConsole.sh &&
cd $app_dir
echo "tail -f ./nohup.out 可以查看日志"
nohup ./startBFTConsole.sh &

---------------------

-------------------
# 单纯启动
# 直接使用功能
tar_form="*Console.tar" &&
app_jar=$(find . -name $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
cd $app_dir &&
echo "tail -f ./nohup.out 可以查看日志" &&
bash ./startBFTConsole.sh &&
nohup ./startBFTConsole.sh &&

```



## 复制原本的配置文件

## == primeton 单机部署【v1-sh-all安装】

### 场景描述

```
1. 这个是 console, server, logcenter, agent1, agent2 都是在同一个机器上
2. 新旧系统都在这个系统上面配置文件直接复制粘贴到新的系统上
	old --> new
总结
	直接复制到新的安装文件夹中
1. 先创建一个版本文件夹	
```

### 解压

```bash
#!/bash/bin
echo "=====旧的安装包的配置文件到 prepared 文件夹=====" &&
declare -A app_tars

# 需要更改软件安装位置
base_app="$(pwd)"
prepare="$(pwd)/prepare"
# 安装文件夹
version="7.5.0"
app_tars["console"]="Primeton_BFT_${version}_Console.tar"
app_tars["server"]="Primeton_BFT_${version}_Server.tar"
app_tars["logcenter"]="Primeton_BFT_${version}_LogCenter.tar"
app_tars["agent1"]="Primeton_BFT_${version}_Agent.tar"
app_tars["agent2"]="Primeton_BFT_${version}_Agent.tar"
# 先解压 console, server, logcenter
for key in ${!app_tars[*]}
do  	
	echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="
	app=$key
	app_dir=$(basename "${app_tars[$key]}" .tar) 
	
    if echo "$app_name" | grep -q "agent"; then 
    	echo "agent 单独创建"	
    else  
        mkdir $app_dir
        tar -vxf $app_jar -C $app_dir
    fi
    echo "app 安装完毕"
done

echo "循环安装 agent, 这个需要单独安装========================="
agent_num=2
for(a=1; a<=$agent_num; a++)
do
	app_jar="Primeton_BFT_${version}_Agent.tar"
    app_dir="$(basename "${app_tars[$key]}" .tar)_${a}"
    mkdir $app_dir
    tar -vxf $app_jar -C $app_dir 
    echo "app 安装完毕"	
done


```





### prepared -- 项目复制到 prepared

```bash
#!/bash/bin
echo "=====旧的安装包的配置文件到 prepared 文件夹=====" &&
declare -A app_dir

# 需要更改软件安装位置
old_base_app="/opt/bft/bft7.5ga1043"
prepare=""
# 安装文件夹
app_dir["console"]="${old_base_app}/Primeton_BFT_7.5.0_Console"
app_dir["server"]="${old_base_app}/Primeton_BFT_7.5.0_Server"
app_dir["logcenter"]="${old_base_app}/Primeton_BFT_7.5.0_LogCenter"
app_dir["agent1"]="${old_base_app}/Primeton_BFT_7.5.0_Agent_1"
app_dir["agent2"]="${old_base_app}/Primeton_BFT_7.5.0_Agent_2"

echo "== 配置文件 ==="
declare -A app_config_file
app_config_file["console"]="conf/application.properties"
app_config_file["server"]="bftserver/config/bft-server-config.xml"
app_config_file["logcenter"]="conf/application.properties"
app_config_file["agent1"]="bftagent/config/bft-agent-config.xml"
app_config_file["agent2"]="bftagent/config/bft-agent-config.xml"
for key in ${!app_dir[*]}
do  	
	app_name=$key 
	dir=${app_dir[$key]}
	config_file=${app_config_file[$key]}
	prepare_config_dir="$prepare/$app_name/$(dirname $config_file)"
	mkdir -p $prepare_config_dir
	cp $app/${config_file} $prepare_config_dir
done

echo "== 驱动文件夹, =="
echo "请复制驱动文件"
mkdir -p $prepare/db-driver
echo -n "
	手动复制复制驱动文件: mysql
	$(ls ${app_dir["console"]}/libs | grep -i mysql)
	---
	cp app_dir["console"]/libs/驱动   $prepare/db-driver &&
	
" 


```



### prepared -- prepared 复制到项目

* 需要将项目解压完全

```bash
#!/bash/bin
echo "=====旧的安装包的配置文件到 prepared 文件夹=====" &&
# 需要更改软件安装位置
base_app="$(pwd)"
prepare="$(pwd)/prepare"
db-driver="$(ls prepare)"

declare -A app_tars
declare -A app_config_file
declare -A app_app_db-driver

# 安装文件夹
version="7.5.0"
app_tars["console"]="Primeton_BFT_${version}_Console.tar"
app_tars["server"]="Primeton_BFT_${version}_Server.tar"
app_tars["logcenter"]="Primeton_BFT_${version}_LogCenter"
app_tars["agent1"]="Primeton_BFT_${version}_Agent.tar"
app_tars["agent2"]="Primeton_BFT_${version}_Agent.tar"

echo "== 配置文件 ==="
app_config_file["console"]="conf/application.properties"
app_config_file["server"]="bftserver/config/bft-server-config.xml"
app_config_file["logcenter"]="conf/application.properties"
app_config_file["agent1"]="bftagent/config/bft-agent-config.xml"
app_config_file["agent2"]="bftagent/config/bft-agent-config.xml"

echo "数据库驱动的目录 "
app_db-driver["console"]="libs"
app_db-driver["server"]="bftserver/lib"
app_db-driver["logcenter"]="lib"

for key in ${!app_tars[*]}
do  	
	app_name=$key
	app_dir=$(basename "${app_tars[$key]}" .tar) 
	
	# 配置文件
	config_file=${app_config_file[$key]}
	prepare_config_dir="$prepare/$app_name/$(dirname $config_file)"

    if echo "$app_name" | grep -q "agent"; then 
    	echo -n "
    		 ==========================================================================
    		需要手动复制 agent 的配置文件
             agent:${app_name}
             cp $prepare/${app_name}/$config_file ${app_dir}/$(dirname $config_file)
             ==========================================================================
    	"
    else  
        echo " $app_name 复制驱动 "  
		cp $app_dir/${config_file}  $app_dir/${config_file}.bak
		rm $app_dir/${config_file}
		cp $prepare/$app_name/${config_file} $app_dir/$(dirname $config_file)
    fi	
	
	# 复制数据库驱动
    if echo "$app_name" | grep -q "agent"; then 
    else   
        echo 没有复制驱动----$(ls $app_dir/${app_db-driver[$key]} | grep sql)
        cp $prepare/lib/db-driver $app_dir/${app_db-driver[$key]}
        echo 复制驱动完成----$(ls $app_dir/${app_db-driver[$key]} | grep sql)
    fi

	# echo "===== 配置 ${app_name} 配置完成 =====" 
done 
```

### 数据库初始化

```bash
# 初次安装



# 版本跟新，进行数据库更新
# 安装包目录\Primeton_BFT_7.5.0_Console\dbscripts\mysql中有一个6.upgrade_2phase_mysql.sql, 一行一行去执行, 报错的忽略, 执行下一行
tar_form="*Console.tar" &&
config_file="dbscripts/mysql/6.upgrade_2phase_mysql.sql" && 

app_jar=$(find . -name $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
cp ${app_dir}/$config_file tmp && 
ll tmp &&
```



### 全部启动

### 日志汇总

```
```



### all-sh 启动

```bash
#!/bash/bin
echo "=====旧的安装包的配置文件到 prepared 文件夹=====" &&
# 需要更改软件安装位置
base_app="$(pwd)"
prepare="$(pwd)/prepare"
db-driver="$(ls prepare)"

declare -A app_tars
declare -A app_config_file
declare -A app_app_db-driver

# 安装文件夹
version="7.5.0"
app_tars["console"]="Primeton_BFT_${version}_Console.tar"
app_tars["server"]="Primeton_BFT_${version}_Server.tar"
app_tars["logcenter"]="Primeton_BFT_${version}_LogCenter"
app_tars["agent1"]="Primeton_BFT_${version}_Agent_1"
app_tars["agent2"]="Primeton_BFT_${version}_Agent_2"

echo "== 配置文件 ==="
app_config_file["console"]="conf/application.properties"
app_config_file["server"]="bftserver/config/bft-server-config.xml"
app_config_file["logcenter"]="conf/application.properties"
app_config_file["agent1"]="Primeton_BFT_${version}_Agent_1"
app_config_file["agent2"]="Primeton_BFT_${version}_Agent_2"

echo "数据库驱动的目录 "
app_db-driver["console"]="libs"
app_db-driver["server"]="bftserver/lib"
app_db-driver["logcenter"]="lib"


# 创建文件



# 复制配置文件
for key in ${!app_tars[*]}
do  	
	app_name=$key
	app_dir=$(basename "${app_tars[$key]}" .tar) 
	
	# 配置文件
	config_file=${app_config_file[$key]}
	prepare_config_dir="$prepare/$app_name/$(dirname $config_file)"

	cp $app_dir/${config_file}  $app_dir/${config_file}.bak
	rm $app_dir/${config_file}
	cp $prepare/$app_name/${config_file} $app_dir/$(dirname $config_file)
	
	# 复制数据库驱动
    if echo "$app_name" | grep -q "agent"; then  
   		echo " agent 不需要进行数据库驱动复制 " 	
    else  
        echo " $app_name 复制驱动 "  
        echo 没有复制驱动----$(ls $app_dir/${app_db-driver[$key]} | grep sql)
        cp $prepare/lib/db-driver $app_dir/${app_db-driver[$key]}
        echo 复制驱动完成----$(ls $app_dir/${app_db-driver[$key]} | grep sql)
    fi

	# echo "===== 配置 ${app_name} 配置完成 =====" 
done 
```







## == 富国多机部署



### prepared

* 既然你都笃定了有旧的安装包，为啥非得搞这么复杂

* primeton 一体机

  ```bash 
  
  
  echo "====== 复制驱动 ======" &&
  
  old_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
  db_driver_parttern="mysql" &&
  mkdir -p prepared/db-driver  &&
  echo "相关的数据库驱动有 $(ls ${old_dir}/libs | grep -i ${db_driver_parttern})" &&
  echo "输入需要复制的数据库驱动"
  read need_driver &&
  cp $old_dir/libs/$db_driver  prepared/db-driver  &&
  
  
  echo "==复制配置文件： console" &&
  old_dir='/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
  config_file="conf/application.properties" && 
  confile_dir="prepared/console/$(dirname $config_file)" &&
  mkdir -p ${confile_dir} &&
  cp ${old_dir}/${config_file} ${confile_dir} && 
  
  echo "==复制配置文件： server" &&
  old_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Server" &&
  config_file="bftserver/config/bft-server-config.xml" &&
  confile_dir="prepared/server/$(dirname $config_file)" &&
  mkdir -p ${confile_dir} &&
  cp ${old_dir}/${config_file} ${confile_dir} && 
  
  
  echo "==复制配置文件： logcenter" &&
  old_dir='/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
  config_file=="conf/application.properties" &&
  confile_dir="prepared/logcenter/$(dirname $config_file)" &&
  mkdir -p ${confile_dir} &&
  cp ${old_dir}/${config_file} ${confile_dir} && 
  
  echo "agent 命名规则 agent1"
  echo "==复制配置文件： agent-------------1            " &&
  old_dir='/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
  config_file=="bftagent/config/bft-agent-config.xml" &&
  confile_dir="prepared/agent-1/$(dirname $config_file)" &&
  mkdir -p ${confile_dir} &&
  cp ${old_dir}/${config_file} ${confile_dir} && 
  ```

  

* 富国分离机

```bash


echo "====== 复制驱动 ======" &&

old_dir='/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
db_driver_parttern="mysql" &&
mkdir -p prepared/db-driver  &&
echo "相关的数据库驱动有 $(ls ${old_dir}/libs | grep -i ${db_driver_parttern})" &&
echo "输入需要复制的数据库驱动"
read need_driver &&
cp $old_dir/libs/$db_driver  prepared/db-driver  &&


echo "==复制配置文件： console" &&
old_dir='/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
config_file="conf/application.properties" && 
confile_dir="prepared/console/$(dirname $config_file)" &&
mkdir -p ${confile_dir} &&
cp ${old_dir}/${config_file} ${confile_dir} && 

echo "==复制配置文件： server" &&
old_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Server" &&
config_file="bftserver/config/bft-server-config.xml" &&
confile_dir="prepared/server/$(dirname $config_file)" &&
mkdir -p ${confile_dir} &&
cp ${old_dir}/${config_file} ${confile_dir} && 


echo "==复制配置文件： logcenter" &&
old_dir='/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
config_file=="conf/application.properties" &&
confile_dir="prepared/logcenter/$(dirname $config_file)" &&
mkdir -p ${confile_dir} &&
cp ${old_dir}/${config_file} ${confile_dir} && 

echo "agent 命名规则 agent1"
echo "==复制配置文件： agent-------------1            " &&
old_dir='/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console' &&
config_file=="bftagent/config/bft-agent-config.xml" &&
confile_dir="prepared/agent-1/$(dirname $config_file)" &&
mkdir -p ${confile_dir} &&
cp ${old_dir}/${config_file} ${confile_dir} && 
```





### console

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console" &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "====================== console 固定信息==========================="  &&
tar_form="*Console.tar" &&
db_lib_dir="libs" &&
config_file="conf/application.properties" &&
log_file="logs/eos-trace.log"
app_jar=$(ls $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
abs_app_dir=$(pwd) &&
old_db_driver="prepared/db-driver/$(ls prepared/db-driver)" &&
old_conf_file="prepared/console/${log_file}"
echo "======================================================================================"  &&
echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="  &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
clear  &&
ll  &&
echo "======================================================================================"  &&
echo "======================复制数据库驱动==========================="  &&
echo 没有复制驱动----$(ls $app_dir/$db_lib_dir | grep sql) &&
cp $old_db_driver $app_dir/$db_lib_dir &&
echo 复制驱动完成----$(ls $app_dir/$db_lib_dir | grep sql) &&
echo "======================================================================================"  &&
echo "=================================复制旧的配置文件======================================"  &&
cp $app_dir/$config_file $app_dir/${config_file}.bak &&
rm $app_dir/$config_file &&
cp ${old_conf_file} $app_dir/$(dirname $config_file) &&
echo "======================================================================================"  &&
echo "=================================提示信息======================================"  &&
echo -n "
旧配置文件路径--${old_app_dir}/${config_file}
新配置文件路径--${app_dir}/${config_file}

==== 查看日志信息 ====	
tail -50f ${abs_app_dir}/${app_dir}/${log_file}
启动成功信息： AppServer started on port(s) ... 
tail -50f ${abs_app_dir}/${app_dir}/${log_file} | grep AppServer started on port(s)

==== 部署成功，web 登录登录BFT控制管理中心 ====
http://${app_ip："ip"}:28082/bftconsole

=== 账号密码信息
系统管理员用户：sysadmin，初始密码：0000000
操作员 ：operator，初始密码：000000

=== 注意
管理服务器（BFTServer）需要在控制管理中心（BFTConsole）进行注册后才可正常启动，
替换升级的不需要，因为没改变什么


=== 启动
    echo "需要停止原本的项目，然后进行启动" &&
    cd $app_dir &&
    bash ${old_app_dir}/$stop_sh &&  停止原本的项目
    bash $start_sh
=== 关闭
	bash shutdown.sh
" &&
echo "=================================项目启动======================================"  &&
echo "需要停止原本的项目，然后进行启动" &&
cd $app_dir &&
ls -l &&
```

### server

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Server" &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "====================== server 固定信息==========================="  &&
tar_form="*Server.tar"  &&
config_file="bftserver/config/bft-server-config.xml" &&
db_lib_dir="bftserver/lib" &&
log_file="bftserver/logs/bftserver.log" &&
app_jar=$(find . -name $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
abs_dir=$(pwd) &&
old_db_driver="prepared/db-driver/$(ls prepared/db-driver)" &&
old_conf_file="prepared/server/${log_file}" &&
echo "======================================================================================"  &&
echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="  &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
clear  &&
ll  &&
echo "======================================================================================"  &&
echo "======================复制数据库驱动==========================="  &&
echo 没有复制驱动----$(ls $app_dir/$db_lib_dir | grep sql) &&
cp $old_db_driver $app_dir/$db_lib_dir &&
echo 复制驱动完成----$(ls $app_dir/$db_lib_dir | grep sql) &&
echo "======================================================================================"  &&
echo "=================================复制旧的配置文件======================================"  &&
cp $app_dir/$config_file $app_dir/${config_file}.bak &&
rm $app_dir/$config_file &&
cp ${old_conf_file} $app_dir/$(dirname $config_file) &&
echo "======================================================================================"  &&
echo "=================================提示信息======================================"  &&
echo -n "
旧配置文件路径--${old_app_dir}/${config_file}
新配置文件路径--${app_dir}/${config_file}



==== 部署成功，web 登录登录BFT控制管理中心 ====
http://${ip: "ip"}:28082/bftconsole

=== 账号密码信息
系统管理员用户：sysadmin，初始密码：0000000
操作员 ：operator，初始密码：000000

=== 注意
管理服务器（BFTServer）需要在控制管理中心（BFTConsole）进行注册后才可正常启动，
替换升级的不需要，因为没改变什么

start_sh=startBFTServer.sh
stop_sh=stopBFTServer.sh 

" &&
echo "=================================项目启动======================================"  &&
echo "需要停止原本的项目，然后进行启动" &&
cd $app_dir &&
ls -l &&
```

##### 启动

```bash
追加的形式
bash ${old_dir}/$stop_sh &&
bash $start_sh


```





 

### logCenter 

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_LogCenter" &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "======================logcenter固定信息==========================="  &&
tar_form="*LogCenter.tar"  &&
config_file="confi/application.properties" &&
db_lib_dir="lib" &&
start_sh="startup.sh" &&
stop_sh="shutdown.sh" &&
log_file="logs/bftlogcenter.log"
app_jar=$(ls $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
abs_dir=$(pwd) &&
old_db_driver="prepared/db-driver/$(ls prepared/db-driver)" &&
old_conf_file="prepared/logcenter/${log_file}" &&
echo "======================================================================================"  &&
echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="  &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
clear  &&
ll  &&
echo "======================================================================================"  &&
echo "======================复制数据库驱动==========================="  &&
echo 没有复制驱动----$(ls $app_dir/$db_lib_dir | grep sql) &&
cp $old_db_driver $app_dir/$db_lib_dir &&
echo 复制驱动完成----$(ls $app_dir/$db_lib_dir | grep sql) &&
echo "======================================================================================"  &&
echo "=================================复制旧的配置文件======================================"  &&
cp $app_dir/$config_file $app_dir/${config_file}.bak &&
rm $app_dir/$config_file &&
cp ${old_conf_file} $app_dir/$(dirname $config_file) &&
echo "======================================================================================"  &&
echo "=================================提示信息======================================"  &&
echo -n "
旧配置文件路径--${old_app_dir}/${config_file}
新配置文件路径--${app_dir}/${config_file}

==== 查看日志信息 ====	
tail -50f ${abs_app_dir}/${app_dir}/${log_file}
启动成功信息：日志中心（BFTLogCenter）启动成功 
tail -50f ${abs_app_dir}/${app_dir}/${log_file} | grep 日志中心（BFTLogCenter）启动成功

==== 部署成功，浏览器访问BFT Logcenter，登录日志中心管理端 ====
http://${ip}:29098

==== 启动信息 ====
bash ${old_dir}/$stop_sh &&
bash $start_sh

==== 关闭程序 ====
bash $stop_sh

" &&
echo "=================================项目启动======================================"  &&
echo "需要停止原本的项目，然后进行启动" &&
cd $app_dir &&
ls -l &&
```



### agent

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
echo "======================================================================================"  &&
echo "======================logcenter固定信息==========================="  &&
tar_form="Primeton_BFT_*_Agent.tar"  &&
config_file="bftagent/config/bft-agent-config.xml" &&
app_jar=$(ls $tar_form) &&
echo "===========创建不同的 agent==============="
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Agent02" &&
app_dir=$(basename "$app_jar" .tar)_2 &&
abs_dir=$(pwd) &&
echo "======================================================================================"  &&
echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="  &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
clear  &&
ll  &&
echo "======================================================================================"  &&
echo "=================================复制旧的配置文件======================================"  &&
config_dir=$(dirname $config_file) &&
mkdir ${app_dir}/tmp &&
cp $app_dir/$config_file $app_dir/${config_file}.bak &&
rm $app_dir/$config_file &&
cp ${old_app_dir}/$config_file $app_dir/tmp &&
cp ${old_app_dir}/$config_file $app_dir/$config_dir &&
echo "======================================================================================"  &&
echo "=================================提示信息======================================"  &&
echo -n "

新配置文件路径--${app_dir}/${config_file}

==== 查看日志信息 ====	
tail -50f ${abs_app_dir}/${app_dir}/${log_file}
启动成功信息：日志中心（BFTLogCenter）启动成功 
tail -50f ${abs_app_dir}/${app_dir}/${log_file} | grep login success

==== 启动信息 ====
nohup ./startBFTAgent.sh &

==== 关闭程序 ====
bash shutdown.sh

" &&
echo "=================================项目启动======================================"  &&
echo "需要停止原本的项目，然后进行启动" &&
cd $app_dir &&
ls -l &&
```



# 哑安装

## 富国--单机部署--new

### 准备

```bash
1. installer , console, server, agent, logcenter 在同一个文件夹
2. {
# 需要提前准备好这些东西
# 根据需要删除 agent 
├── prepare
│   ├── db-driver
│   │   ├── mysql.jar
│   ├── config
│   │   ├── console-install.properties
│   │   ├── server-install.properties
│   │   ├── logcenter-install.properties
│   │   └── agent1-install.properties 
│   │   └── agent2-install.propertie

```

### 解压复制

```bash
#!/bash/bin
echo "=====旧的安装包的配置文件到 prepared 文件夹=====" &&
declare -A app_dirs
declare -A 


# 安装文件夹
version="7.5.0"
installer="primeton-installer-1.2.0"
 
# 需要更改软件安装位置
base_app="$(pwd)"
prepare="$(pwd)/prepare" 
app_suffix=".tar"

app_dirs["console"]="Primeton_BFT_${version}_Console"
app_dirs["server"]="Primeton_BFT_${version}_Server"
app_dirs["logcenter"]="Primeton_BFT_${version}_LogCenter"
app_dirs["agent1"]="Primeton_BFT_${version}_Agent"
app_dirs["agent2"]="Primeton_BFT_${version}_Agent"
# 先解压 console, server, logcenter
for key in ${!app_dirs[*]}
do  	
	echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="
	app=$key
	app_dir=${app_dirs[$key]} 	
	if [$app_name eq "agent1"]; then
    	app_dir=${app_dir}_1
	elif [$app_name eq "agent2"]; then
    	app_dir=${app_dir}_2 
    fi
    mkdir $app_dir
    tar -vxf ${app_jar}${app_suffix} -C $app_dir
    echo "app 安装完毕"
done


# 复制配置文件
for key in ${!app_dirs[*]}
do  	
	echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="
	
	
	app=$key
	app_dir=${app_dirs[$key]} 	
	rm_config
	if [$app_name eq "console"]; then
    	rm_config="consoleConfig"
	elif [$app_name eq "server"]; then
    	rm_config="serverConfig"
	elif [$app_name eq "logcenter"]; then
    	rm_config="consoleConfig"
	elif [$app_name eq "agent1"]; then
    	app_dir=${app_dir}_1  
    	rm_config="agentConfig"
	elif [$app_name eq "agent2"]; then
    	app_dir=${app_dir}_2    
    	rm_config="agentConfig"        
    fi
    # installer-console
    installer_name=${installer}-${app_name}
    mkdir installer
    tar -vxf ${installer}${app_suffix} -C $installer_name
    
    cp "${installer_name}/configs/${rm_config}/application.yml" cp "${installer_name}/config"
    # cp "${installer_name}/configs/${rm_config}/install.properties" cp "${installer_name}/config"
    # cp  ${prepare}/config/${app_name}-install.properties  cp "${installer_name}/config/install.properties"

	# 启动
	bash ${installer_name}/install.sh  
    
    
done

abs_dir=$(pwd)
echo -n "
console 启动
	cd ${abs_dir}/${app_dirs["console"]}
	nohup ./startBFTConsole.sh &
	
    ==== 查看日志信息: 启动成功信息： AppServer started on port(s) ...  ====	
    tail -50f ${abs_dir}/${app_dirs["console"]}/logs/eos-trace.log
    ==== 部署成功，web 登录登录BFT控制管理中心 ====
    http://${app_ip："ip"}:28082/bftconsole
	
server 启动
	cd ${abs_dir}/${app_dirs["server"]}
	nohup ./startBFTServer.sh &
	
	==== 查看日志信息: 启动成功信息： AppServer started on port(s) ... ====	
    tail -50f ${abs_dir}/${app_dirs["server"]}/bftserver/logs/bftserver.log
 
	
logcenter 启动
	cd ${abs_dir}/${app_dirs["logcenter"]}
	nohup ./startup.sh &
	
	==== 查看日志信息: 启动成功信息： AppServer started on port(s) ... ====	
    tail -50f ${abs_dir}/${app_dirs["server"]}/bftserver/logs/bftlogcenter.log
	
agent 启动
	cd ${abs_dir}/${app_dirs["agent1"]}
	ohup ./startBFTAgent.sh &
	
	==== 查看日志信息: 启动成功信息： login success ====	
    tail -50f ${abs_dir}/${app_dirs["server"]}/bftserver/logs/bftAgent.log
	
	
agent 启动
	cd ${abs_dir}/${app_dirs["agent2"]}
	ohup ./startBFTAgent.sh &	
"


```

### 启动

```
```



# ----------------



# 安装 -- 解压非复制

## 统计信息

### console

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console" &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "======================logcenter固定信息==========================="  &&
tar_form="*Console.tar" &&
db_lib_dir="libs" &&
config_file="conf/application.properties" &&
start_sh="startBFTConsole.sh" &&
stop_sh="stopBFTConsole.sh" &&
log_file="logs/eos-trace.log"



=================================
启动程序
	// cd $app_dir
	nohup ./startBFTConsole.sh &
关闭程序
	// cd $app_dir
    bash stopBFTConsole.sh
```

### server

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
old_app_dir="/opt/bft/bft7.5ga/Primeton_BFT_7.5.0_Console" &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "======================logcenter固定信息==========================="  &&
tar_form="*Console.tar" &&
db_lib_dir="libs" &&
config_file="conf/application.properties" &&
start_sh="startBFTConsole.sh" &&
stop_sh="stopBFTConsole.sh" &&
log_file="logs/eos-trace.log"



=================================
启动程序
	// cd $app_dir
	nohup ./startBFTConsole.sh &
关闭程序
	// cd $app_dir
    bash stopBFTConsole.sh
```



### logcenter

```
```







## logcenter

```bash
echo "==============================项目不同，会出现变化的地方================================"  &&
app_ip="192.168.1.174" &&
echo "======================================================================================"  &&
echo "======================logcenter固定信息==========================="  &&
tar_form="*LogCenter.tar"  &&
config_file="config/application.properties" &&
db_lib_dir="lib" &&
log_file="logs/bftlogcenter.log" &&
app_jar=$(ls $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
abs_dir=$(pwd) &&
echo "======================================================================================"  &&
echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="  &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
clear  &&
ll  &&
echo "======================================================================================"  &&
echo "======================复制数据库驱动==========================="  &&
echo 没有复制驱动----$(ls $app_dir/$db_lib_dir | grep sql) &&
cp $db_driver $app_dir/$db_lib_dir &&
echo 复制驱动完成----$(ls $app_dir/$db_lib_dir | grep sql) &&
echo "======================================================================================"  &&
echo "=================================配置文件信息======================================"  &&
echo -n "
	1. 查看修改日志中心端口，名称
	2. 修改数据库相关信息：driver, dialect, name, password, url
	-----
	输入 y ：编辑 $app_dir/$config_file
" &&
echo "======================================================================================"  &&
echo "=================================提示信息======================================"  &&
echo -n "

新配置文件路径--${app_dir}/${config_file}

==== 查看日志信息 ====	
tail -50f ${abs_app_dir}/${app_dir}/${log_file}
启动成功信息：日志中心（BFTLogCenter）启动成功 
tail -50f ${abs_app_dir}/${app_dir}/${log_file} | grep 日志传输形式为日志文件传输

==== 启动信息 ====
nohup ./startup.sh &

==== 关闭程序 ====
bash shutdown.sh

" &&
echo "=================================项目启动======================================"  &&
echo "需要停止原本的项目，然后进行启动" &&
cd $app_dir &&
ls -l &&
```







# 待整理

```bash
mysql_sql_setup = (
	bftconsole_drop_mysql.sql
	bftconsole_create_mysql.sql
	bftconsole_upgrade.sql
	coframe-table-mysql.sql
	coframe-data-mysql.sql
)

exe_mysq=mysql_sql_setup
for ((i=0; index le ${#exe_mysq[@]}; i++))
do
    mysql -h 127.0.0.1 -P 3306 -u root -pprimeton afcenter4eos82 < ${exe_mysq[i]}
done


# 配置文件 application.properties
/*

spring.jpa.database=mysql
---- 数据库方言，详情参考安装须知
---- 如果BFT Console安装成功启动一次后，再需要修改数据库时，需要修改“/root/BFT7.5LA/conf/application.properties”下的数据库连接。
spring.jpa.hibernate.ddl-auto=none
spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect

spring.datasource.username=root
spring.datasource.password={3DES}PTYuw43evG6J3SolWKSyDvo=
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/bft75ga
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
 

console_org_config=(
	'^spring.datasource.username=.*'
	'^spring.datasource.password=.*'
	'spring.datasource.url=jdbc:mysql:.*'
	'spring.datasource.driver-class-name=.*'
)

console_used_config=(
	'^spring.datasource.username=${mysql_name}'
	'^spring.datasource.password=${mysql_password}'
	'spring.datasource.url=${mysql_url}'
	'spring.datasource.driver-class-name=${mysql_dirver}'
)


*/

console_config_size=${#console_org_config[@]}
for ((index=0; index le console_config_size; index++ ))
do
	echo "测试sed:  "
	sed -i 's/${console_org_config[index]}/${console_used_config[index]\r/' ${application.properties_path}
done

```



### 

























