# ==

# governor



## 独立安装 -- 解压安装

### 初始化数据库

```bash
echo -n "
1. 哑安装不需要单独进行数据库初始化

==== windows =====
2. 这个需要先在 window 解压，然后进行顺序初始化
    1. eos/Mysql/eos_all.sql
    2. afcenter/Mysql/afc_all.sql
    3. esb/Mysql/1-esb-afc-data.sql
    4. esb/Mysql/2-schema-esb-mysql.sql
    5. esb/Mysql/3-data-esb-mysql.sql
" &&
tar_form="Primeton_ESB-*Governor_Standalone" &&
app_jar=$(ls $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
abs_dir=$(pwd) &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
mkdir $app_dir/tmp  &&
cp $app_dir/db-scripts/eos/Mysql/eos_all.sql $app_dir/tmp &&
cp $app_dir/db-scripts/afcenter/Mysql/afc_all.sql $app_dir/tmp &&
cp $app_dir/db-scripts/esb/Mysql/1-esb-afc-data.sql $app_dir/tmp &&
cp $app_dir/db-scripts/esb/Mysql/2-schema-esb-mysql.sql $app_dir/tmp &&
cp $app_dir/db-scripts/esb/Mysql/3-data-esb-mysql.sql $app_dir/tmp &&
ls ${abs_dir}/$app_dir/tmp &&
echo -n "
脚本所在文件夹为：
	${abs_dir}/$app_dir/tmp
" &&
```

### 步骤

```bash
#!/bin/bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
governor_dir=""
app_ip="" &&
app_port="8080" &&

echo "======================================================================================"  &&
echo "====================== primeton-installer 固定信息==========================="  &&
tar_form="primeton-installer-*.tar" &&
db_lib_dir="drivers" &&
config_file="config/install.properties" &&
start_sh="install.sh" &&

app_jar=$(ls $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
abs_dir=$(pwd) &&
config_dir=$(dirname $config_file) &&

echo "======================================================================================"  &&
echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="  &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
clear  &&
ll  &&


echo "======================================================================================"  &&
echo "======================复制数据库驱动==========================="  &&
echo $(ls $app_dir/$db_lib_dir | grep sql) &&
cp $db_driver $app_dir/$db_lib_dir &&
echo $(ls $app_dir/$db_lib_dir | grep sql) &&

echo "=================================复制安装文件======================================"  &&
cp -r $app_dir/config/template/governor/standalone/* $app_dir/config &&
vim $app_dir/$config_file &&


echo "=================================提示信息======================================"  &&
echo -n "


===== 哑安装 ======
bash ${app_dir}/${start_sh}

===== governor ======
1. 进入 governor 安装目录，执行  进行启动
bash start.sh

==== 查看日志信息 ====	
tail -50f ${abs_app_dir}/${app_dir}/${log_file}
启动成功信息： AppServer started on port(s) ... 
tail -50f ${abs_app_dir}/${app_dir}/${log_file} | grep "AppServer started on port(s)"

==== 部署成功，web 登录登录 ESB 控制管理中心 ====
http://${ip}:${app_port}”

===== 注意 ======
1. 为了保证密码安全，哑安装成功后，请立即删除
	rm ${abs_dir}/${app_dir}/install.properties
2. 数据库初始化
如果安装ESB Server时已经初始化过数据库，需要将initDB和forceInitDB的配置改为false，不再执行初始化脚本，如下：
	initDB=false
	forceInitDB=false
2. MySQL哑安装需要使用5.x版本的驱动，
	如果ESB Governor运行时想使用8.x版本，可以在哑安装完成后，手动删除${esb-governor安装目录}/lib目录的5.x驱动，重新放入8.x驱动		



=== 账号密码信息
ESB管理员身份（esbadmin/000000）
系统管理员用户名：sysesbadmin，初始密码：000000
	系统管理员负责创建用户、删除用户，
安全管理员用户名：security，初始密码：000000
	安全管理员负责给用户分配角色，角色权限设置，
安全审计员用户名：audit，初始密码：000000
	安全审计员负责查看Governor操作日志，

=== 注意 

" &&


```



## 独立安装 -- 哑安装[推荐]

```bash
#!/bin/bash
echo "==============================项目不同，会出现变化的地方================================"  &&
db_driver='mysql-connector-java-5.1.32.jar' &&
app_ip="" &&
app_port="8080" &&

echo "======================================================================================"  &&
echo "====================== primeton-installer 固定信息==========================="  &&
tar_form="primeton-installer-*.tar" &&
db_lib_dir="drivers" &&
config_file="config/install.properties" &&
start_sh="install.sh" &&

app_jar=$(ls $tar_form) &&
app_dir=$(basename "$app_jar" .tar) &&
abs_dir=$(pwd) &&
config_dir=$(dirname $config_file) &&

echo "======================================================================================"  &&
echo "======================创建 ${app_jar} 安装文件夹， 并进行解压==========================="  &&
mkdir $app_dir  &&
tar -vxf $app_jar -C $app_dir  &&
clear  &&
ll  &&


echo "======================================================================================"  &&
echo "======================复制数据库驱动==========================="  &&
echo $(ls $app_dir/$db_lib_dir | grep sql) &&
cp $db_driver $app_dir/$db_lib_dir &&
echo $(ls $app_dir/$db_lib_dir | grep sql) &&

echo "=================================复制安装文件======================================"  &&
cp -r $app_dir/config/template/governor/standalone/* $app_dir/config &&
vim $app_dir/$config_file &&


echo "=================================提示信息======================================"  &&
governor_dir=$(grep "^destPath=" $app_dir/$config_file | cut -d'=' -f2)
echo -n "


===== 哑安装 ======
bash ${app_dir}/${start_sh}


===== 注意 ======
1. 为了保证密码安全，哑安装成功后，请立即删除
	rm ${abs_dir}/${app_dir}/install.properties
2. 数据库初始化
如果安装ESB Server时已经初始化过数据库，需要将initDB和forceInitDB的配置改为false，不再执行初始化脚本，如下：
	initDB=false
	forceInitDB=false
2. MySQL哑安装需要使用5.x版本的驱动，
	如果ESB Governor运行时想使用8.x版本，可以在哑安装完成后，手动删除${esb-governor安装目录}/lib目录的5.x驱动，重新放入8.x驱动		

===== governor ======
cd ${governor_dir}
1. 进入 governor 安装目录，执行  进行启动
bash start.sh

2. 停止 governor 服务 
bash shutdown.sh

==== 查看日志信息 ====	
tail -50f logs/eos-trace.log
启动成功信息： AppServer started on port(s) ... 
tail -50f logs/eos-trace.log | grep "AppServer started on port(s)"

==== 部署成功，web 登录登录 ESB 控制管理中心 ==== 。
http://${ip}:${app_port}
http://${ip}:${app_port}/#/login”



=== 账号密码信息
ESB管理员身份（esbadmin/000000）
系统管理员用户名：sysesbadmin，初始密码：000000
	系统管理员负责创建用户、删除用户，
安全管理员用户名：security，初始密码：000000
	安全管理员负责给用户分配角色，角色权限设置，
安全审计员用户名：audit，初始密码：000000
	安全审计员负责查看Governor操作日志，

=== 注意 

" &&


```



